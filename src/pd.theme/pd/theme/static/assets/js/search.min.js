jQuery(function(a){var b,c,d,e,f=a("#search-results"),g=a("#search-filter"),h=a("#search-field"),i=a("#searchGadget"),j=a("form.searchPage"),k=a('link[rel="home"]').attr("href")||window.navigation_root_url||window.portal_url;a.fn.pullSearchResults=function(b){return this.each(function(){var c=a(this);a.get("@@updated_search",b,function(d){c.hide();var e=a('<div id="ajax-search-res"></div>').html(d),f=a("#search-term"),g=e.find("#search-results").children(),h=e.find("#updated-search-term").text(),i=e.find("#updated-search-results-number").text(),j=e.find("#updated-sorting-options").html();c.html(g),c.fadeIn(),f.length||(f=a('<strong id="search-term" />').appendTo("h1.documentFirstHeading")),f.text(h),a("#search-results-number").text(i),a("#search-results-bar").find("#sorting-options").html(j),a("#rss-subscription").find("a.link-feed").attr("href",function(){return k+"/search_rss?"+b})})})},c=function(a){if(Modernizr.history){var b=k+"/@@search?"+a;history.pushState(null,null,b)}},d=window.history&&"state"in window.history,e=location.href,a(window).bind("popstate",function(c){var g,j;if(g=!d&&location.href===e,d=!0,!g&&location.search){b=location.search.split("?")[1];var k=b.match(/SearchableText=[^&]*/);k&&(j=k[0],j=decodeURIComponent(j.replace(/\+/g," ")),a.merge(h.find('input[name="SearchableText"]'),i).val(j.substr(15,j.length)),f.pullSearchResults(b))}}),g.find('input.searchPage[type="submit"]').hide(),h.find("input.searchButton").click(function(b){var d,i,k,e=location.search.substring(1),g=/([^&=]+)=([^&]*)/g,j=[];for(d=h.find('input[name="SearchableText"]').val(),j.push({name:"SearchableText",value:d});i=g.exec(e);)"SearchableText"!==(k=decodeURIComponent(i[1]))&&j.push({name:k,value:decodeURIComponent(i[2].replace(/\+/g," "))});e=a.param(j),f.pullSearchResults(e),c(e),b.preventDefault()}),j.submit(function(d){b=a(this).serialize(),f.pullSearchResults(b),c(b),d.preventDefault()}),h.find('input[name="SearchableText"]').keyup(function(){i.val(a(this).val())}),a("#search-results-bar").find("dl.actionMenu > dd.actionMenuContent").click(function(a){a.stopImmediatePropagation()}),g.delegate("input, select","change",function(a){b="",g.find("input:checked").length>1&&(b=j.serialize()),f.pullSearchResults(b),c(b)}),a("#sorting-options").delegate("a","click",function(d){a(this).attr("data-sort")?j.find("input[name='sort_on']").val(a(this).attr("data-sort")):j.find("input[name='sort_on']").val(""),b=this.search.split("?")[1],f.pullSearchResults(b),c(b),d.preventDefault()}),f.delegate(".listingBar a","click",function(a){b=this.search.split("?")[1],f.pullSearchResults(b),c(b),a.preventDefault()})});